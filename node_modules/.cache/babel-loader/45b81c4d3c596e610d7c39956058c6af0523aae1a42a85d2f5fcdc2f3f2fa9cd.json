{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport { ref, onMounted } from 'vue';\nimport axios from 'axios';\nexport default {\n  __name: 'ChangeRole',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const utilizadores = ref([]);\n    const mensagem = ref('');\n    const user = ref(null);\n    const token = localStorage.getItem('token');\n\n    // Carrega o utilizador logado\n    onMounted(async () => {\n      try {\n        const resUser = await axios.get('http://localhost:3000/api/perfil', {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n        user.value = resUser.data;\n        await carregarUtilizadores();\n      } catch (err) {\n        console.error('Erro ao carregar utilizadores:', err);\n      }\n    });\n    async function carregarUtilizadores() {\n      try {\n        const res = await axios.get('http://localhost:3000/api/utilizadores');\n        utilizadores.value = res.data;\n      } catch (err) {\n        console.error('Erro ao buscar utilizadores:', err);\n      }\n    }\n    async function atualizarRole(utilizador) {\n      try {\n        const res = await axios.put(`http://localhost:3000/api/utilizadores/${utilizador._id}`, {\n          role: utilizador.role\n        });\n        mensagem.value = `Role de ${res.data.nome} atualizada!`;\n      } catch (err) {\n        mensagem.value = 'Erro ao atualizar role.';\n        console.error(err);\n      }\n    }\n    async function apagarUtilizador(id) {\n      if (!confirm('Tem certeza que deseja apagar este utilizador?')) return;\n      try {\n        await axios.delete(`http://localhost:3000/api/utilizadores/${id}`);\n        mensagem.value = 'Utilizador apagado com sucesso!';\n        utilizadores.value = utilizadores.value.filter(u => u._id !== id);\n      } catch (err) {\n        mensagem.value = 'Erro ao apagar utilizador.';\n        console.error(err);\n      }\n    }\n    const __returned__ = {\n      utilizadores,\n      mensagem,\n      user,\n      token,\n      carregarUtilizadores,\n      atualizarRole,\n      apagarUtilizador,\n      ref,\n      onMounted,\n      get axios() {\n        return axios;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","axios","utilizadores","mensagem","user","token","localStorage","getItem","resUser","get","headers","Authorization","value","data","carregarUtilizadores","err","console","error","res","atualizarRole","utilizador","put","_id","role","nome","apagarUtilizador","id","confirm","delete","filter","u"],"sources":["C:/Users/heieb/OneDrive/Ambiente de Trabalho/10ABRIL/Projeto-PTR-PTI/src/components/ChangeRole.vue"],"sourcesContent":["<template>\r\n  <div class=\"tabela-utilizadores\">\r\n    <h1>Gest√£o de Utilizadores</h1>\r\n\r\n    <table>\r\n      <thead>\r\n        <tr>\r\n          <th>Nome</th>\r\n          <th>Email</th>\r\n          <th>Role</th>\r\n          <th>A√ß√µes</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        <tr v-for=\"u in utilizadores\" :key=\"u._id\">\r\n          <td>{{ u.nome }}</td>\r\n          <td>{{ u.email }}</td>\r\n          <td>\r\n            <select v-model=\"u.role\" @change=\"atualizarRole(u)\">\r\n              <option value=\"cliente\">cliente</option>\r\n              <option value=\"doador\">doador</option>\r\n              <option value=\"empregado\" v-if=\"user && user.role === 'admin'\">empregado</option>\r\n              <option value=\"admin\" v-if=\"user && user.role === 'admin'\">admin</option>\r\n            </select>\r\n          </td>\r\n          <td>\r\n            <button @click=\"apagarUtilizador(u._id)\">üóëÔ∏è Apagar</button>\r\n          </td>\r\n        </tr>\r\n      </tbody>\r\n    </table>\r\n\r\n    <div v-if=\"mensagem\">{{ mensagem }}</div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted } from 'vue';\r\nimport axios from 'axios';\r\n\r\nconst utilizadores = ref([]);\r\nconst mensagem = ref('');\r\nconst user = ref(null);\r\nconst token = localStorage.getItem('token');\r\n\r\n// Carrega o utilizador logado\r\nonMounted(async () => {\r\n  try {\r\n    const resUser = await axios.get('http://localhost:3000/api/perfil', {\r\n      headers: { Authorization: `Bearer ${token}` },\r\n    });\r\n    user.value = resUser.data;\r\n\r\n    await carregarUtilizadores();\r\n  } catch (err) {\r\n    console.error('Erro ao carregar utilizadores:', err);\r\n  }\r\n});\r\n\r\nasync function carregarUtilizadores() {\r\n  try {\r\n    const res = await axios.get('http://localhost:3000/api/utilizadores');\r\n    utilizadores.value = res.data;\r\n  } catch (err) {\r\n    console.error('Erro ao buscar utilizadores:', err);\r\n  }\r\n}\r\n\r\nasync function atualizarRole(utilizador) {\r\n  try {\r\n    const res = await axios.put(`http://localhost:3000/api/utilizadores/${utilizador._id}`, {\r\n      role: utilizador.role,\r\n    });\r\n    mensagem.value = `Role de ${res.data.nome} atualizada!`;\r\n  } catch (err) {\r\n    mensagem.value = 'Erro ao atualizar role.';\r\n    console.error(err);\r\n  }\r\n}\r\n\r\nasync function apagarUtilizador(id) {\r\n  if (!confirm('Tem certeza que deseja apagar este utilizador?')) return;\r\n\r\n  try {\r\n    await axios.delete(`http://localhost:3000/api/utilizadores/${id}`);\r\n    mensagem.value = 'Utilizador apagado com sucesso!';\r\n    utilizadores.value = utilizadores.value.filter((u) => u._id !== id);\r\n  } catch (err) {\r\n    mensagem.value = 'Erro ao apagar utilizador.';\r\n    console.error(err);\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.tabela-utilizadores {\r\n  padding: 20px;\r\n}\r\n\r\ntable {\r\n  width: 100%;\r\n  border-collapse: collapse;\r\n  margin-top: 10px;\r\n}\r\n\r\nth, td {\r\n  padding: 8px;\r\n  border: 1px solid #ccc;\r\n}\r\n\r\nselect {\r\n  padding: 4px;\r\n}\r\n</style>\r\n"],"mappings":";;AAqCA,SAASA,GAAG,EAAEC,SAAS,QAAQ,KAAK;AACpC,OAAOC,KAAK,MAAM,OAAO;;;;;;;IAEzB,MAAMC,YAAY,GAAGH,GAAG,CAAC,EAAE,CAAC;IAC5B,MAAMI,QAAQ,GAAGJ,GAAG,CAAC,EAAE,CAAC;IACxB,MAAMK,IAAI,GAAGL,GAAG,CAAC,IAAI,CAAC;IACtB,MAAMM,KAAK,GAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;;IAE3C;IACAP,SAAS,CAAC,YAAY;MACpB,IAAI;QACF,MAAMQ,OAAO,GAAG,MAAMP,KAAK,CAACQ,GAAG,CAAC,kCAAkC,EAAE;UAClEC,OAAO,EAAE;YAAEC,aAAa,EAAE,UAAUN,KAAK;UAAG;QAC9C,CAAC,CAAC;QACFD,IAAI,CAACQ,KAAK,GAAGJ,OAAO,CAACK,IAAI;QAEzB,MAAMC,oBAAoB,CAAC,CAAC;MAC9B,CAAC,CAAC,OAAOC,GAAG,EAAE;QACZC,OAAO,CAACC,KAAK,CAAC,gCAAgC,EAAEF,GAAG,CAAC;MACtD;IACF,CAAC,CAAC;IAEF,eAAeD,oBAAoBA,CAAA,EAAG;MACpC,IAAI;QACF,MAAMI,GAAG,GAAG,MAAMjB,KAAK,CAACQ,GAAG,CAAC,wCAAwC,CAAC;QACrEP,YAAY,CAACU,KAAK,GAAGM,GAAG,CAACL,IAAI;MAC/B,CAAC,CAAC,OAAOE,GAAG,EAAE;QACZC,OAAO,CAACC,KAAK,CAAC,8BAA8B,EAAEF,GAAG,CAAC;MACpD;IACF;IAEA,eAAeI,aAAaA,CAACC,UAAU,EAAE;MACvC,IAAI;QACF,MAAMF,GAAG,GAAG,MAAMjB,KAAK,CAACoB,GAAG,CAAC,0CAA0CD,UAAU,CAACE,GAAG,EAAE,EAAE;UACtFC,IAAI,EAAEH,UAAU,CAACG;QACnB,CAAC,CAAC;QACFpB,QAAQ,CAACS,KAAK,GAAG,WAAWM,GAAG,CAACL,IAAI,CAACW,IAAI,cAAc;MACzD,CAAC,CAAC,OAAOT,GAAG,EAAE;QACZZ,QAAQ,CAACS,KAAK,GAAG,yBAAyB;QAC1CI,OAAO,CAACC,KAAK,CAACF,GAAG,CAAC;MACpB;IACF;IAEA,eAAeU,gBAAgBA,CAACC,EAAE,EAAE;MAClC,IAAI,CAACC,OAAO,CAAC,gDAAgD,CAAC,EAAE;MAEhE,IAAI;QACF,MAAM1B,KAAK,CAAC2B,MAAM,CAAC,0CAA0CF,EAAE,EAAE,CAAC;QAClEvB,QAAQ,CAACS,KAAK,GAAG,iCAAiC;QAClDV,YAAY,CAACU,KAAK,GAAGV,YAAY,CAACU,KAAK,CAACiB,MAAM,CAAEC,CAAC,IAAKA,CAAC,CAACR,GAAG,KAAKI,EAAE,CAAC;MACrE,CAAC,CAAC,OAAOX,GAAG,EAAE;QACZZ,QAAQ,CAACS,KAAK,GAAG,4BAA4B;QAC7CI,OAAO,CAACC,KAAK,CAACF,GAAG,CAAC;MACpB;IACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}