{"ast":null,"code":"import { ref, onMounted } from 'vue';\nimport axios from 'axios';\nimport { useRouter } from 'vue-router';\nexport default {\n  __name: 'ChangeRole',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const router = useRouter();\n    const nomeBusca = ref('');\n    const utilizador = ref(null);\n    const novaRole = ref('');\n    const mensagem = ref('');\n    const token = localStorage.getItem('token');\n    const user = ref(null);\n    function voltar() {\n      router.back();\n    }\n    async function buscarUtilizador() {\n      try {\n        const res = await axios.get(`http://localhost:3000/api/utilizadores/nome/${nomeBusca.value}`);\n        utilizador.value = res.data;\n        novaRole.value = res.data.role;\n        mensagem.value = '';\n      } catch (err) {\n        utilizador.value = null;\n        mensagem.value = 'Utilizador não encontrado.';\n      }\n    }\n    async function alterarRole() {\n      if (!utilizador.value || !novaRole.value) return;\n      try {\n        const res = await axios.put(`http://localhost:3000/api/utilizadores/${utilizador.value._id}`, {\n          role: novaRole.value\n        });\n        utilizador.value = res.data;\n        mensagem.value = 'Role atualizada com sucesso!';\n      } catch (err) {\n        console.error(err);\n        mensagem.value = 'Erro ao atualizar role.';\n      }\n    }\n    onMounted(async () => {\n      try {\n        const resUser = await axios.get('http://localhost:3000/api/perfil', {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n        console.log('Usuário carregado:', user.value);\n        user.value = resUser.data;\n      } catch (err) {\n        console.error('Erro ao buscar equipamentos:', err);\n      }\n    });\n    const __returned__ = {\n      router,\n      nomeBusca,\n      utilizador,\n      novaRole,\n      mensagem,\n      token,\n      user,\n      voltar,\n      buscarUtilizador,\n      alterarRole,\n      ref,\n      onMounted,\n      get axios() {\n        return axios;\n      },\n      get useRouter() {\n        return useRouter;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","axios","useRouter","router","nomeBusca","utilizador","novaRole","mensagem","token","localStorage","getItem","user","voltar","back","buscarUtilizador","res","get","value","data","role","err","alterarRole","put","_id","console","error","resUser","headers","Authorization","log"],"sources":["C:/Users/heieb/OneDrive/Ambiente de Trabalho/10ABRIL/Projeto-PTR-PTI/src/components/ChangeRole.vue"],"sourcesContent":["<template>\r\n  <div class=\"detalhes\">\r\n    <header>\r\n      <h1>Alterar Roles</h1>\r\n      <button @click=\"voltar\">← Voltar</button>\r\n    </header>\r\n\r\n    <section>\r\n      <input\r\n        v-model=\"nomeBusca\"\r\n        type=\"text\"\r\n        placeholder=\"Nome do utilizador\"\r\n      />\r\n      <button @click=\"buscarUtilizador\">Buscar</button>\r\n    </section>\r\n\r\n    <div v-if=\"utilizador\" class=\"info-utilizador\">\r\n      <h2>{{ utilizador.nome }}</h2>\r\n      <p>Email: {{ utilizador.email }}</p>\r\n      <p>Role atual: <strong>{{ utilizador.role }}</strong></p>\r\n\r\n      <label for=\"novaRole\">Nova Role:</label>\r\n      <select id=\"novaRole\" v-model=\"novaRole\">\r\n        <option value=\"cliente\">cliente</option>\r\n        <option v-if=\"user && (user.role === 'admin')\" value=\"admin\">admin</option>\r\n        <option v-if=\"user && (user.role === 'admin')\" value=\"empregado\">empregado</option>\r\n        <option value=\"doador\">doador</option>\r\n        \r\n      </select>\r\n\r\n      <button @click=\"alterarRole\">Alterar Role</button>\r\n    </div>\r\n\r\n    <div v-if=\"mensagem\" class=\"mensagem\">{{ mensagem }}</div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted } from 'vue';\r\nimport axios from 'axios';\r\nimport { useRouter } from 'vue-router';\r\n\r\nconst router = useRouter();\r\nconst nomeBusca = ref('');\r\nconst utilizador = ref(null);\r\nconst novaRole = ref('');\r\nconst mensagem = ref('');\r\nconst token = localStorage.getItem('token');\r\nconst user = ref(null);\r\n\r\nfunction voltar() {\r\n  router.back();\r\n}\r\n\r\n\r\n\r\nasync function buscarUtilizador() {\r\n  try {\r\n    const res = await axios.get(`http://localhost:3000/api/utilizadores/nome/${nomeBusca.value}`);\r\n    utilizador.value = res.data;\r\n    novaRole.value = res.data.role;\r\n    mensagem.value = '';\r\n  } catch (err) {\r\n    utilizador.value = null;\r\n    mensagem.value = 'Utilizador não encontrado.';\r\n  }\r\n}\r\n\r\nasync function alterarRole() {\r\n  if (!utilizador.value || !novaRole.value) return;\r\n\r\n  try {\r\n    const res = await axios.put(`http://localhost:3000/api/utilizadores/${utilizador.value._id}`, {\r\n      role: novaRole.value,\r\n    });\r\n\r\n    utilizador.value = res.data;\r\n    mensagem.value = 'Role atualizada com sucesso!';\r\n  } catch (err) {\r\n    console.error(err);\r\n    mensagem.value = 'Erro ao atualizar role.';\r\n  }\r\n}\r\n\r\nonMounted(async () => {\r\n  \r\n  try {\r\n\r\n    const resUser = await axios.get('http://localhost:3000/api/perfil', {\r\n      headers: {\r\n        Authorization: `Bearer ${token}`\r\n      }\r\n  });\r\n\r\n  console.log('Usuário carregado:', user.value);\r\n\r\n   user.value = resUser.data;\r\n\r\n  } catch (err) {\r\n    console.error('Erro ao buscar equipamentos:', err);\r\n  }\r\n});\r\n</script>\r\n\r\n<style scoped>\r\n.detalhes {\r\n  max-width: 800px;\r\n  margin: 40px auto;\r\n  padding: 20px;\r\n  background-color: #f8f9fa;\r\n  border-radius: 10px;\r\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);\r\n}\r\n\r\nheader {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 20px;\r\n}\r\n\r\ninput,\r\nselect {\r\n  padding: 10px;\r\n  margin: 10px 0;\r\n  width: 100%;\r\n}\r\n\r\nbutton {\r\n  background-color: #0d6efd;\r\n  color: white;\r\n  border: none;\r\n  padding: 10px 15px;\r\n  border-radius: 6px;\r\n  cursor: pointer;\r\n}\r\n\r\nbutton:hover {\r\n  background-color: #084298;\r\n}\r\n\r\n.info-utilizador {\r\n  margin-top: 20px;\r\n  background: #fff;\r\n  padding: 15px;\r\n  border-radius: 10px;\r\n  box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.mensagem {\r\n  margin-top: 20px;\r\n  font-weight: bold;\r\n  color: green;\r\n}\r\n</style>\r\n"],"mappings":"AAsCA,SAASA,GAAG,EAAEC,SAAS,QAAQ,KAAK;AACpC,OAAOC,KAAK,MAAM,OAAO;AACzB,SAASC,SAAS,QAAQ,YAAY;;;;;;;IAEtC,MAAMC,MAAM,GAAGD,SAAS,CAAC,CAAC;IAC1B,MAAME,SAAS,GAAGL,GAAG,CAAC,EAAE,CAAC;IACzB,MAAMM,UAAU,GAAGN,GAAG,CAAC,IAAI,CAAC;IAC5B,MAAMO,QAAQ,GAAGP,GAAG,CAAC,EAAE,CAAC;IACxB,MAAMQ,QAAQ,GAAGR,GAAG,CAAC,EAAE,CAAC;IACxB,MAAMS,KAAK,GAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;IAC3C,MAAMC,IAAI,GAAGZ,GAAG,CAAC,IAAI,CAAC;IAEtB,SAASa,MAAMA,CAAA,EAAG;MAChBT,MAAM,CAACU,IAAI,CAAC,CAAC;IACf;IAIA,eAAeC,gBAAgBA,CAAA,EAAG;MAChC,IAAI;QACF,MAAMC,GAAG,GAAG,MAAMd,KAAK,CAACe,GAAG,CAAC,+CAA+CZ,SAAS,CAACa,KAAK,EAAE,CAAC;QAC7FZ,UAAU,CAACY,KAAK,GAAGF,GAAG,CAACG,IAAI;QAC3BZ,QAAQ,CAACW,KAAK,GAAGF,GAAG,CAACG,IAAI,CAACC,IAAI;QAC9BZ,QAAQ,CAACU,KAAK,GAAG,EAAE;MACrB,CAAC,CAAC,OAAOG,GAAG,EAAE;QACZf,UAAU,CAACY,KAAK,GAAG,IAAI;QACvBV,QAAQ,CAACU,KAAK,GAAG,4BAA4B;MAC/C;IACF;IAEA,eAAeI,WAAWA,CAAA,EAAG;MAC3B,IAAI,CAAChB,UAAU,CAACY,KAAK,IAAI,CAACX,QAAQ,CAACW,KAAK,EAAE;MAE1C,IAAI;QACF,MAAMF,GAAG,GAAG,MAAMd,KAAK,CAACqB,GAAG,CAAC,0CAA0CjB,UAAU,CAACY,KAAK,CAACM,GAAG,EAAE,EAAE;UAC5FJ,IAAI,EAAEb,QAAQ,CAACW;QACjB,CAAC,CAAC;QAEFZ,UAAU,CAACY,KAAK,GAAGF,GAAG,CAACG,IAAI;QAC3BX,QAAQ,CAACU,KAAK,GAAG,8BAA8B;MACjD,CAAC,CAAC,OAAOG,GAAG,EAAE;QACZI,OAAO,CAACC,KAAK,CAACL,GAAG,CAAC;QAClBb,QAAQ,CAACU,KAAK,GAAG,yBAAyB;MAC5C;IACF;IAEAjB,SAAS,CAAC,YAAY;MAEpB,IAAI;QAEF,MAAM0B,OAAO,GAAG,MAAMzB,KAAK,CAACe,GAAG,CAAC,kCAAkC,EAAE;UAClEW,OAAO,EAAE;YACPC,aAAa,EAAE,UAAUpB,KAAK;UAChC;QACJ,CAAC,CAAC;QAEFgB,OAAO,CAACK,GAAG,CAAC,oBAAoB,EAAElB,IAAI,CAACM,KAAK,CAAC;QAE5CN,IAAI,CAACM,KAAK,GAAGS,OAAO,CAACR,IAAI;MAE1B,CAAC,CAAC,OAAOE,GAAG,EAAE;QACZI,OAAO,CAACC,KAAK,CAAC,8BAA8B,EAAEL,GAAG,CAAC;MACpD;IACF,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}