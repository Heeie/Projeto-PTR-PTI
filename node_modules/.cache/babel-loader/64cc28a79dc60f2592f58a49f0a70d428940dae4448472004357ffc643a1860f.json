{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.iterator.reduce.js\";\nimport { ref, computed } from 'vue';\nimport { useCarrinhoStore } from '@/stores/carrinho';\nimport { useRouter } from 'vue-router';\n\n// Store e router\n\nexport default {\n  __name: 'CompraProduto',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const carrinhoStore = useCarrinhoStore();\n    const router = useRouter();\n\n    // Referências reativas\n    const numeroMBWay = ref('');\n    const mensagem = ref('');\n\n    // Computed: lista e total\n    const carrinho = computed(() => carrinhoStore.equipamentos);\n    const total = computed(() => carrinho.value.reduce((soma, item) => soma + Number(item.preco), 0));\n    async function finalizarCompra() {\n      if (!numeroMBWay.value.match(/^9[1236][0-9]{7}$/)) {\n        mensagem.value = 'Número MBWay inválido.';\n        return;\n      }\n      try {\n        await new Promise(resolve => setTimeout(resolve, 1500));\n\n        // Simulação: substitui por ID real\n        const lojaId = '6650dd0f26e3b38b9260b9f7';\n        const response = await fetch('http://localhost:3000/api/transacoes', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'Authorization': `Bearer ${localStorage.getItem('token')}` // ou como guardaste o token\n          },\n          body: JSON.stringify({\n            loja_id: lojaId,\n            equipamentos: carrinho.value.map(item => item._id),\n            total: total.value\n          })\n        });\n        if (!response.ok) throw new Error('Erro ao criar transação');\n        const result = await response.json();\n        mensagem.value = `Pagamento MBWay para ${numeroMBWay.value} concluído com sucesso! Transação ID: ${result.transacao._id}`;\n        carrinhoStore.limparCarrinho();\n        setTimeout(() => {\n          router.push('/home');\n        }, 7000);\n      } catch (error) {\n        mensagem.value = 'Erro ao processar pagamento. Tente novamente.';\n        console.error(error);\n      }\n    }\n    const __returned__ = {\n      carrinhoStore,\n      router,\n      numeroMBWay,\n      mensagem,\n      carrinho,\n      total,\n      finalizarCompra,\n      ref,\n      computed,\n      get useCarrinhoStore() {\n        return useCarrinhoStore;\n      },\n      get useRouter() {\n        return useRouter;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","computed","useCarrinhoStore","useRouter","carrinhoStore","router","numeroMBWay","mensagem","carrinho","equipamentos","total","value","reduce","soma","item","Number","preco","finalizarCompra","match","Promise","resolve","setTimeout","lojaId","response","fetch","method","headers","localStorage","getItem","body","JSON","stringify","loja_id","map","_id","ok","Error","result","json","transacao","limparCarrinho","push","error","console"],"sources":["C:/Users/heieb/OneDrive/Ambiente de Trabalho/10ABRIL/Projeto-PTR-PTI/src/components/CompraProduto.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <header>\r\n      <h1>Finalizar Compra</h1>\r\n      <nav>\r\n        <ul>\r\n          <li class=\"homebar\"><router-link to=\"/home\">Início</router-link></li>\r\n          <li class=\"homebar\"><router-link to=\"/\">Produtos</router-link></li>\r\n        </ul>\r\n      </nav>\r\n    </header>\r\n\r\n    <section class=\"compra\">\r\n      <h2>Itens no Carrinho</h2>\r\n      <div v-if=\"carrinho.length > 0\">\r\n        <ul>\r\n          <li v-for=\"(item, index) in carrinho\" :key=\"index\">\r\n            {{ item.nome }} - € {{ Number(item.preco).toFixed(2) }}\r\n          </li>\r\n        </ul>\r\n        <p><strong>Total:</strong> € {{ total.toFixed(2) }}</p>\r\n\r\n        <form @submit.prevent=\"finalizarCompra\">\r\n          <label for=\"mbway\">Número de Telemóvel (MBWay):</label>\r\n          <input\r\n            type=\"tel\"\r\n            id=\"mbway\"\r\n            v-model=\"numeroMBWay\"\r\n            placeholder=\"912345678\"\r\n            required\r\n            pattern=\"[9][1236][0-9]{7}\"\r\n          />\r\n          <button type=\"submit\">Pagar com MBWay</button>\r\n        </form>\r\n\r\n        <div v-if=\"mensagem\" class=\"mensagem\">{{ mensagem }}</div>\r\n\r\n      </div>\r\n      <div v-else>\r\n        <p>O carrinho está vazio.</p>\r\n        <div class=\"mensagem\">{{ mensagem }}</div>\r\n      </div>\r\n    </section>\r\n\r\n    <footer>\r\n      <p>&copy; 2025 Loja Tech - Todos os direitos reservados.</p>\r\n    </footer>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, computed } from 'vue';\r\nimport { useCarrinhoStore } from '@/stores/carrinho';\r\nimport { useRouter } from 'vue-router';\r\n\r\n// Store e router\r\nconst carrinhoStore = useCarrinhoStore();\r\nconst router = useRouter();\r\n\r\n// Referências reativas\r\nconst numeroMBWay = ref('');\r\nconst mensagem = ref('');\r\n\r\n// Computed: lista e total\r\nconst carrinho = computed(() => carrinhoStore.equipamentos);\r\nconst total = computed(() =>\r\n  carrinho.value.reduce((soma, item) => soma + Number(item.preco), 0)\r\n);\r\n\r\nasync function finalizarCompra() {\r\n  if (!numeroMBWay.value.match(/^9[1236][0-9]{7}$/)) {\r\n    mensagem.value = 'Número MBWay inválido.';\r\n    return;\r\n  }\r\n\r\n  try {\r\n    await new Promise((resolve) => setTimeout(resolve, 1500));\r\n\r\n    // Simulação: substitui por ID real\r\n    const lojaId = '6650dd0f26e3b38b9260b9f7';\r\n\r\n    const response = await fetch('http://localhost:3000/api/transacoes', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': `Bearer ${localStorage.getItem('token')}` // ou como guardaste o token\r\n      },\r\n      body: JSON.stringify({\r\n        loja_id: lojaId,\r\n        equipamentos: carrinho.value.map(item => item._id),\r\n        total: total.value\r\n      })\r\n    });\r\n\r\n    if (!response.ok) throw new Error('Erro ao criar transação');\r\n\r\n    const result = await response.json();\r\n\r\n    mensagem.value = `Pagamento MBWay para ${numeroMBWay.value} concluído com sucesso! Transação ID: ${result.transacao._id}`;\r\n    carrinhoStore.limparCarrinho();\r\n\r\n    setTimeout(() => {\r\n      router.push('/home');\r\n    }, 7000);\r\n\r\n  } catch (error) {\r\n    mensagem.value = 'Erro ao processar pagamento. Tente novamente.';\r\n    console.error(error);\r\n  }\r\n}\r\n\r\n</script>\r\n\r\n<style scoped>\r\n\r\n.homebar{\r\n  color: black;\r\n}\r\nheader {\r\n  background: #0d6efd;\r\n  color: #fff;\r\n  padding: 20px;\r\n  text-align: center;\r\n  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\r\n}\r\n\r\nnav ul {\r\n  list-style: none;\r\n  display: flex;\r\n  justify-content: center;\r\n  gap: 20px;\r\n  padding: 0;\r\n}\r\n\r\nnav ul li a {\r\n  color: #975d5d;\r\n  text-decoration: none;\r\n  font-weight: bold;\r\n}\r\n\r\n.compra {\r\n  padding: 40px;\r\n  max-width: 600px;\r\n  margin: 0 auto;\r\n  background-color: #f4f6ff;\r\n  border-radius: 12px;\r\n  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.compra h2 {\r\n  text-align: center;\r\n  margin-bottom: 20px;\r\n}\r\n\r\nul {\r\n  list-style: none;\r\n  padding: 0;\r\n}\r\n\r\nli {\r\n  background: white;\r\n  padding: 10px;\r\n  margin-bottom: 8px;\r\n  border-radius: 6px;\r\n  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);\r\n}\r\n\r\nform {\r\n  margin-top: 20px;\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 12px;\r\n}\r\n\r\ninput {\r\n  padding: 10px;\r\n  border: 1px solid #ccc;\r\n  border-radius: 6px;\r\n}\r\n\r\nbutton {\r\n  background-color: #198754;\r\n  color: white;\r\n  padding: 12px;\r\n  border: none;\r\n  border-radius: 6px;\r\n  font-size: 16px;\r\n  font-weight: bold;\r\n  cursor: pointer;\r\n  transition: background-color 0.3s;\r\n}\r\n\r\nbutton:hover {\r\n  background-color: #146c43;\r\n}\r\n\r\n.mensagem {\r\n  margin-top: 15px;\r\n  font-weight: bold;\r\n  color: green;\r\n  text-align: center;\r\n}\r\n\r\nfooter {\r\n  background: #0d6efd;\r\n  color: #fff;\r\n  text-align: center;\r\n  padding: 20px;\r\n  margin-top: 40px;\r\n  font-size: 14px;\r\n}\r\n</style>"],"mappings":";;;;AAmDA,SAASA,GAAG,EAAEC,QAAQ,QAAQ,KAAK;AACnC,SAASC,gBAAgB,QAAQ,mBAAmB;AACpD,SAASC,SAAS,QAAQ,YAAY;;AAEtC;;;;;;;;IACA,MAAMC,aAAa,GAAGF,gBAAgB,CAAC,CAAC;IACxC,MAAMG,MAAM,GAAGF,SAAS,CAAC,CAAC;;IAE1B;IACA,MAAMG,WAAW,GAAGN,GAAG,CAAC,EAAE,CAAC;IAC3B,MAAMO,QAAQ,GAAGP,GAAG,CAAC,EAAE,CAAC;;IAExB;IACA,MAAMQ,QAAQ,GAAGP,QAAQ,CAAC,MAAMG,aAAa,CAACK,YAAY,CAAC;IAC3D,MAAMC,KAAK,GAAGT,QAAQ,CAAC,MACrBO,QAAQ,CAACG,KAAK,CAACC,MAAM,CAAC,CAACC,IAAI,EAAEC,IAAI,KAAKD,IAAI,GAAGE,MAAM,CAACD,IAAI,CAACE,KAAK,CAAC,EAAE,CAAC,CACpE,CAAC;IAED,eAAeC,eAAeA,CAAA,EAAG;MAC/B,IAAI,CAACX,WAAW,CAACK,KAAK,CAACO,KAAK,CAAC,mBAAmB,CAAC,EAAE;QACjDX,QAAQ,CAACI,KAAK,GAAG,wBAAwB;QACzC;MACF;MAEA,IAAI;QACF,MAAM,IAAIQ,OAAO,CAAEC,OAAO,IAAKC,UAAU,CAACD,OAAO,EAAE,IAAI,CAAC,CAAC;;QAEzD;QACA,MAAME,MAAM,GAAG,0BAA0B;QAEzC,MAAMC,QAAQ,GAAG,MAAMC,KAAK,CAAC,sCAAsC,EAAE;UACnEC,MAAM,EAAE,MAAM;UACdC,OAAO,EAAE;YACP,cAAc,EAAE,kBAAkB;YAClC,eAAe,EAAE,UAAUC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC;UAC7D,CAAC;UACDC,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAC;YACnBC,OAAO,EAAEV,MAAM;YACfb,YAAY,EAAED,QAAQ,CAACG,KAAK,CAACsB,GAAG,CAACnB,IAAI,IAAIA,IAAI,CAACoB,GAAG,CAAC;YAClDxB,KAAK,EAAEA,KAAK,CAACC;UACf,CAAC;QACH,CAAC,CAAC;QAEF,IAAI,CAACY,QAAQ,CAACY,EAAE,EAAE,MAAM,IAAIC,KAAK,CAAC,yBAAyB,CAAC;QAE5D,MAAMC,MAAM,GAAG,MAAMd,QAAQ,CAACe,IAAI,CAAC,CAAC;QAEpC/B,QAAQ,CAACI,KAAK,GAAG,wBAAwBL,WAAW,CAACK,KAAK,yCAAyC0B,MAAM,CAACE,SAAS,CAACL,GAAG,EAAE;QACzH9B,aAAa,CAACoC,cAAc,CAAC,CAAC;QAE9BnB,UAAU,CAAC,MAAM;UACfhB,MAAM,CAACoC,IAAI,CAAC,OAAO,CAAC;QACtB,CAAC,EAAE,IAAI,CAAC;MAEV,CAAC,CAAC,OAAOC,KAAK,EAAE;QACdnC,QAAQ,CAACI,KAAK,GAAG,+CAA+C;QAChEgC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC;MACtB;IACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}