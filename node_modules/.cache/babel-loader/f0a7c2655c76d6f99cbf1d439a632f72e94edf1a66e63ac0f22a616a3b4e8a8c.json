{"ast":null,"code":"import { createElementVNode as _createElementVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createCommentVNode as _createCommentVNode, vModelSelect as _vModelSelect, withDirectives as _withDirectives } from \"vue\";\nconst _hoisted_1 = {\n  class: \"tabela-utilizadores\"\n};\nconst _hoisted_2 = [\"onUpdate:modelValue\", \"onChange\"];\nconst _hoisted_3 = {\n  key: 0,\n  value: \"empregado\"\n};\nconst _hoisted_4 = {\n  key: 1,\n  value: \"admin\"\n};\nconst _hoisted_5 = [\"onClick\"];\nconst _hoisted_6 = {\n  key: 0\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_cache[3] || (_cache[3] = _createElementVNode(\"h1\", null, \"Gest√£o de Utilizadores\", -1 /* HOISTED */)), _createElementVNode(\"table\", null, [_cache[2] || (_cache[2] = _createElementVNode(\"thead\", null, [_createElementVNode(\"tr\", null, [_createElementVNode(\"th\", null, \"Nome\"), _createElementVNode(\"th\", null, \"Email\"), _createElementVNode(\"th\", null, \"Role\"), _createElementVNode(\"th\", null, \"A√ß√µes\")])], -1 /* HOISTED */)), _createElementVNode(\"tbody\", null, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.utilizadores, u => {\n    return _openBlock(), _createElementBlock(\"tr\", {\n      key: u._id\n    }, [_createElementVNode(\"td\", null, _toDisplayString(u.nome), 1 /* TEXT */), _createElementVNode(\"td\", null, _toDisplayString(u.email), 1 /* TEXT */), _createElementVNode(\"td\", null, [_withDirectives(_createElementVNode(\"select\", {\n      \"onUpdate:modelValue\": $event => u.role = $event,\n      onChange: $event => $setup.atualizarRole(u)\n    }, [_cache[0] || (_cache[0] = _createElementVNode(\"option\", {\n      value: \"cliente\"\n    }, \"cliente\", -1 /* HOISTED */)), _cache[1] || (_cache[1] = _createElementVNode(\"option\", {\n      value: \"doador\"\n    }, \"doador\", -1 /* HOISTED */)), $setup.user && $setup.user.role === 'admin' ? (_openBlock(), _createElementBlock(\"option\", _hoisted_3, \"empregado\")) : _createCommentVNode(\"v-if\", true), $setup.user && $setup.user.role === 'admin' ? (_openBlock(), _createElementBlock(\"option\", _hoisted_4, \"admin\")) : _createCommentVNode(\"v-if\", true)], 40 /* PROPS, NEED_HYDRATION */, _hoisted_2), [[_vModelSelect, u.role]])]), _createElementVNode(\"td\", null, [_createElementVNode(\"button\", {\n      onClick: $event => $setup.apagarUtilizador(u._id)\n    }, \"üóëÔ∏è Apagar\", 8 /* PROPS */, _hoisted_5)])]);\n  }), 128 /* KEYED_FRAGMENT */))])]), $setup.mensagem ? (_openBlock(), _createElementBlock(\"div\", _hoisted_6, _toDisplayString($setup.mensagem), 1 /* TEXT */)) : _createCommentVNode(\"v-if\", true)]);\n}","map":{"version":3,"names":["class","key","value","_createElementBlock","_hoisted_1","_createElementVNode","_Fragment","_renderList","$setup","utilizadores","u","_id","_toDisplayString","nome","email","$event","role","onChange","atualizarRole","user","_hoisted_3","_createCommentVNode","_hoisted_4","_hoisted_2","onClick","apagarUtilizador","_hoisted_5","mensagem","_hoisted_6"],"sources":["C:\\Users\\heieb\\OneDrive\\Ambiente de Trabalho\\10ABRIL\\Projeto-PTR-PTI\\src\\components\\ChangeRole.vue"],"sourcesContent":["<template>\r\n  <div class=\"tabela-utilizadores\">\r\n    <h1>Gest√£o de Utilizadores</h1>\r\n\r\n    <table>\r\n      <thead>\r\n        <tr>\r\n          <th>Nome</th>\r\n          <th>Email</th>\r\n          <th>Role</th>\r\n          <th>A√ß√µes</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        <tr v-for=\"u in utilizadores\" :key=\"u._id\">\r\n          <td>{{ u.nome }}</td>\r\n          <td>{{ u.email }}</td>\r\n          <td>\r\n            <select v-model=\"u.role\" @change=\"atualizarRole(u)\">\r\n              <option value=\"cliente\">cliente</option>\r\n              <option value=\"doador\">doador</option>\r\n              <option value=\"empregado\" v-if=\"user && user.role === 'admin'\">empregado</option>\r\n              <option value=\"admin\" v-if=\"user && user.role === 'admin'\">admin</option>\r\n            </select>\r\n          </td>\r\n          <td>\r\n            <button @click=\"apagarUtilizador(u._id)\">üóëÔ∏è Apagar</button>\r\n          </td>\r\n        </tr>\r\n      </tbody>\r\n    </table>\r\n\r\n    <div v-if=\"mensagem\">{{ mensagem }}</div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted } from 'vue';\r\nimport axios from 'axios';\r\n\r\nconst utilizadores = ref([]);\r\nconst mensagem = ref('');\r\nconst user = ref(null);\r\nconst token = localStorage.getItem('token');\r\n\r\n// Carrega o utilizador logado\r\nonMounted(async () => {\r\n  try {\r\n    const resUser = await axios.get('http://localhost:3000/api/perfil', {\r\n      headers: { Authorization: `Bearer ${token}` },\r\n    });\r\n    user.value = resUser.data;\r\n\r\n    await carregarUtilizadores();\r\n  } catch (err) {\r\n    console.error('Erro ao carregar utilizadores:', err);\r\n  }\r\n});\r\n\r\nasync function carregarUtilizadores() {\r\n  try {\r\n    const res = await axios.get('http://localhost:3000/api/utilizadores');\r\n    utilizadores.value = res.data;\r\n  } catch (err) {\r\n    console.error('Erro ao buscar utilizadores:', err);\r\n  }\r\n}\r\n\r\nasync function atualizarRole(utilizador) {\r\n  try {\r\n    const res = await axios.put(`http://localhost:3000/api/utilizadores/${utilizador._id}`, {\r\n      role: utilizador.role,\r\n    });\r\n    mensagem.value = `Role de ${res.data.nome} atualizada!`;\r\n  } catch (err) {\r\n    mensagem.value = 'Erro ao atualizar role.';\r\n    console.error(err);\r\n  }\r\n}\r\n\r\nasync function apagarUtilizador(id) {\r\n  if (!confirm('Tem certeza que deseja apagar este utilizador?')) return;\r\n\r\n  try {\r\n    await axios.delete(`http://localhost:3000/api/utilizadores/${id}`);\r\n    mensagem.value = 'Utilizador apagado com sucesso!';\r\n    utilizadores.value = utilizadores.value.filter((u) => u._id !== id);\r\n  } catch (err) {\r\n    mensagem.value = 'Erro ao apagar utilizador.';\r\n    console.error(err);\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.tabela-utilizadores {\r\n  padding: 20px;\r\n}\r\n\r\ntable {\r\n  width: 100%;\r\n  border-collapse: collapse;\r\n  margin-top: 10px;\r\n}\r\n\r\nth, td {\r\n  padding: 8px;\r\n  border: 1px solid #ccc;\r\n}\r\n\r\nselect {\r\n  padding: 4px;\r\n}\r\n</style>\r\n"],"mappings":";;EACOA,KAAK,EAAC;AAAqB;mBADlC;;EAAAC,GAAA;EAqBsBC,KAAK,EAAC;;;EArB5BD,GAAA;EAsBsBC,KAAK,EAAC;;mBAtB5B;;EAAAD,GAAA;AAAA;;uBACEE,mBAAA,CAgCM,OAhCNC,UAgCM,G,0BA/BJC,mBAAA,CAA+B,YAA3B,wBAAsB,sBAE1BA,mBAAA,CA0BQ,gB,0BAzBNA,mBAAA,CAOQ,gBANNA,mBAAA,CAKK,aAJHA,mBAAA,CAAa,YAAT,MAAI,GACRA,mBAAA,CAAc,YAAV,OAAK,GACTA,mBAAA,CAAa,YAAT,MAAI,GACRA,mBAAA,CAAc,YAAV,OAAK,E,wBAGbA,mBAAA,CAgBQ,iB,kBAfNF,mBAAA,CAcKG,SAAA,QA5BbC,WAAA,CAcwBC,MAAA,CAAAC,YAAY,EAAjBC,CAAC;yBAAZP,mBAAA,CAcK;MAd0BF,GAAG,EAAES,CAAC,CAACC;QACpCN,mBAAA,CAAqB,YAAAO,gBAAA,CAAdF,CAAC,CAACG,IAAI,kBACbR,mBAAA,CAAsB,YAAAO,gBAAA,CAAfF,CAAC,CAACI,KAAK,kBACdT,mBAAA,CAOK,a,gBANHA,mBAAA,CAKS;MAvBrB,uBAAAU,MAAA,IAkB6BL,CAAC,CAACM,IAAI,GAAAD,MAAA;MAAGE,QAAM,EAAAF,MAAA,IAAEP,MAAA,CAAAU,aAAa,CAACR,CAAC;kCAC/CL,mBAAA,CAAwC;MAAhCH,KAAK,EAAC;IAAS,GAAC,SAAO,sB,0BAC/BG,mBAAA,CAAsC;MAA9BH,KAAK,EAAC;IAAQ,GAAC,QAAM,sBACGM,MAAA,CAAAW,IAAI,IAAIX,MAAA,CAAAW,IAAI,CAACH,IAAI,gB,cAAjDb,mBAAA,CAAiF,UAAjFiB,UAAiF,EAAlB,WAAS,KArBtFC,mBAAA,gBAsB0Cb,MAAA,CAAAW,IAAI,IAAIX,MAAA,CAAAW,IAAI,CAACH,IAAI,gB,cAA7Cb,mBAAA,CAAyE,UAAzEmB,UAAyE,EAAd,OAAK,KAtB9ED,mBAAA,e,kCAAAE,UAAA,I,gBAkB6Bb,CAAC,CAACM,IAAI,E,KAOzBX,mBAAA,CAEK,aADHA,mBAAA,CAA4D;MAAnDmB,OAAK,EAAAT,MAAA,IAAEP,MAAA,CAAAiB,gBAAgB,CAACf,CAAC,CAACC,GAAG;OAAG,YAAU,iBA1B/De,UAAA,E;sCAgCelB,MAAA,CAAAmB,QAAQ,I,cAAnBxB,mBAAA,CAAyC,OAhC7CyB,UAAA,EAAAhB,gBAAA,CAgC4BJ,MAAA,CAAAmB,QAAQ,oBAhCpCN,mBAAA,e","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}